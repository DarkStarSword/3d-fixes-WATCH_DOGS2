// asmtool.py --fix-wd2-soft-shadows -i --only-autofixed 034264c562c0b80e-ps.txt
//
// Generated by Microsoft (R) D3D Shader Disassembler
//
//   using 3Dmigoto v1.2.42 on Tue Dec 27 10:49:37 2016
//
//
// Input signature:
//
// Name                 Index   Mask Register SysValue  Format   Used
// -------------------- ----- ------ -------- -------- ------- ------
// SV_Position              0   xyzw        0      POS   float   xy  
// TEXCOORD                 0   xyzw        1     NONE   float       
// TEXCOORD                 1   xy          2     NONE   float       
//
//
// Output signature:
//
// Name                 Index   Mask Register SysValue  Format   Used
// -------------------- ----- ------ -------- -------- ------- ------
// SV_TARGET                0   xyzw        0   TARGET   float   xyzw
//
ps_5_0
dcl_globalFlags refactoringAllowed
dcl_constantbuffer cb13[133], immediateIndexed
dcl_resource_texture2dms(0) (float,float,float,float) t1
dcl_resource_buffer (float,float,float,float) t4
dcl_resource_texture2darray (sint,sint,sint,sint) t10
dcl_resource_buffer (sint,sint,sint,sint) t12
dcl_input_ps_siv linear noperspective v0.xy, position
dcl_output o0.xyzw
dcl_temps 13

// 3DMigoto StereoParams:
dcl_resource_texture2d (float,float,float,float) t125

ld_indexable(texture2d)(float,float,float,float) r12.xyzw, l(0, 0, 0, 0), t125.xyzw

add r0.xy, -cb13[109].yxyy, cb13[109].wzww
add r0.zw, v0.xxxy, -cb13[109].yyyx
div r0.xy, r0.zwzz, r0.xyxx
ftoi r1.xy, v0.xyxx
mov r1.zw, l(0,0,0,0)
ldms_indexable(texture2dms)(float,float,float,float) r0.z, r1.xyzw, t1.zwxy, l(0)
eq r1.x, cb13[132].y, l(1.000000)
mov r0.w, l(1.000000)
dp2 r1.y, r0.zwzz, cb13[42].zwzz
dp2 r0.w, r0.zwzz, cb13[43].zwzz
div r0.w, r1.y, r0.w
movc r1.z, r1.x, r0.w, r0.z
mad r1.xy, r0.xyxx, l(2.000000, -2.000000, 0.000000, 0.000000), l(-1.000000, 1.000000, 0.000000, 0.000000)
mov r1.w, l(1.000000)
dp4 r0.x, r1.xyzw, cb13[36].xyzw
dp4 r0.y, r1.xyzw, cb13[37].xyzw
dp4 r0.z, r1.xyzw, cb13[38].xyzw
dp4 r0.w, r1.xyzw, cb13[39].xyzw
div r0.xyzw, r0.xyzw, r0.wwww

// WATCH_DOGS2 soft shadows fix inserted with DarkStarSword's asmtool.py:
// asmtool.py --fix-wd2-soft-shadows -i --only-autofixed 034264c562c0b80e-ps.txt

add r12.w, r0.z, -r12.y
mul r12.w, r12.w, r12.x
mad r0.x, -r12.w, cb13[36].x, r0.x

ld_indexable(buffer)(float,float,float,float) r1.x, l(0, 0, 0, 0), t4.xyzw
eq r1.y, cb13[129].w, l(1.000000)
and r1.z, r1.y, l(0x3f800000)
lt r1.w, r0.z, cb13[129].z
mul r2.x, cb13[108].y, cb13[108].x
ftoi r2.x, r2.x
mov r3.xyw, l(0,0,0,0)
mov r4.w, l(1.000000)
mov r5.w, l(0)
mov r2.y, l(0)
mov r5.z, l(0)
loop 
  itof r2.z, r5.z
  ge r2.z, r2.z, r1.x
  breakc_nz r2.z
  imad r2.z, l(6), r5.z, l(1)
  ld_indexable(buffer)(float,float,float,float) r2.z, r2.zzzz, t4.yzxw
  imad r6.xyzw, l(6, 6, 6, 6), r5.zzzz, l(2, 3, 4, 5)
  ld_indexable(buffer)(float,float,float,float) r2.w, r6.xxxx, t4.yzwx
  ld_indexable(buffer)(float,float,float,float) r6.x, r6.yyyy, t4.xyzw
  ld_indexable(buffer)(float,float,float,float) r6.y, r6.zzzz, t4.yxzw
  ld_indexable(buffer)(float,float,float,float) r6.z, r6.wwww, t4.yzxw
  imad r6.w, l(6), r5.z, l(6)
  ld_indexable(buffer)(float,float,float,float) r6.w, r6.wwww, t4.yzwx
  add r7.x, r6.z, r6.z
  add r7.y, -r2.z, r2.w
  div r7.z, r7.x, r7.y
  add r7.w, -r6.y, r6.x
  div r7.x, r7.x, r7.w
  add r8.x, r2.w, r2.z
  add r2.z, -r2.w, r2.z
  div r4.x, r8.x, r2.z
  add r2.z, r6.y, r6.x
  add r2.w, -r6.x, r6.y
  div r4.y, r2.z, r2.w
  add r2.z, -r6.z, r6.w
  div r2.w, r6.w, r2.z
  mul r6.x, r6.w, r6.z
  add r6.y, -r6.w, r6.z
  div r3.z, r6.x, r6.y
  div r6.xw, l(2.000000, 0.000000, 0.000000, 2.000000), r7.yyyw
  div r2.z, l(1.000000, 1.000000, 1.000000, 1.000000), r2.z
  div r4.z, r6.z, r6.y
  movc r6.xy, r1.yyyy, r7.zxzz, r6.xwxx
  and r6.zw, r1.yyyy, r4.xxxy
  movc r2.z, r1.y, r2.w, r2.z
  movc r7.xyzw, r1.yyyy, r3.xyzw, r4.xyzw
  mul r8.xyzw, r6.zzzz, cb13[54].xyzw
  mad r8.xyzw, cb13[52].xyzw, r6.xxxx, r8.xyzw
  mad r8.xyzw, cb13[55].xyzw, r7.xxxx, r8.xyzw
  mul r9.xyzw, r6.wwww, cb13[54].xyzw
  mad r6.xyzw, cb13[53].xyzw, r6.yyyy, r9.xyzw
  mad r6.xyzw, cb13[55].xyzw, r7.yyyy, r6.xyzw
  mul r9.xyzw, r7.zzzz, cb13[55].xyzw
  mad r9.xyzw, cb13[54].xyzw, r2.zzzz, r9.xyzw
  mul r7.xyzw, r7.wwww, cb13[55].xyzw
  mad r7.xyzw, cb13[54].xyzw, r1.zzzz, r7.xyzw
  mul r10.xyzw, r6.xyzw, cb13[100].yyyy
  mad r10.xyzw, r8.xyzw, cb13[100].xxxx, r10.xyzw
  mad r10.xyzw, r9.xyzw, cb13[100].zzzz, r10.xyzw
  mad r10.xyzw, r7.xyzw, cb13[100].wwww, r10.xyzw
  mul r11.xyzw, r6.xyzw, cb13[101].yyyy
  mad r11.xyzw, r8.xyzw, cb13[101].xxxx, r11.xyzw
  mad r11.xyzw, r9.xyzw, cb13[101].zzzz, r11.xyzw
  mad r11.xyzw, r7.xyzw, cb13[101].wwww, r11.xyzw
  mul r6.xyzw, r6.xyzw, cb13[103].yyyy
  mad r6.xyzw, r8.xyzw, cb13[103].xxxx, r6.xyzw
  mad r6.xyzw, r9.xyzw, cb13[103].zzzz, r6.xyzw
  mad r6.xyzw, r7.xyzw, cb13[103].wwww, r6.xyzw
  dp4 r4.x, r0.xyzw, r10.xyzw
  dp4 r4.y, r0.xyzw, r11.xyzw
  dp4 r2.z, r0.xyzw, r6.xyzw
  div r2.zw, r4.xxxy, r2.zzzz
  lt r4.xy, l(0.000000, 0.000000, 0.000000, 0.000000), r2.zwzz
  lt r6.xy, r2.zwzz, l(1.000000, 1.000000, 0.000000, 0.000000)
  and r3.z, r4.x, r6.x
  and r3.z, r4.y, r3.z
  and r3.z, r6.y, r3.z
  and r4.x, r1.w, r3.z
  if_nz r4.x
    mul r2.zw, r2.zzzw, cb13[111].xxxy
    ftoi r5.xy, r2.zwzz
    ld_indexable(texture2darray)(sint,sint,sint,sint) r2.z, r5.xyzw, t10.yzxw
    mov r4.x, l(0)
    mov r4.y, r2.x
    mov r2.w, r2.z
    loop 
      ige r4.z, r2.w, l(0)
      ilt r5.x, l(0), r4.y
      and r4.z, r4.z, r5.x
      breakc_z r4.z
      ld_indexable(buffer)(sint,sint,sint,sint) r2.w, r2.wwww, t12.yzwx
      iadd r4.xy, r4.xyxx, l(1, -1, 0, 0)
    endloop 
    itof r2.z, r4.x
    mul_sat r2.z, r2.z, l(0.031250)
  else 
    mov r2.z, l(0)
  endif 
  if_nz r3.z
    mov r2.y, r2.z
    break 
  endif 
  iadd r5.z, r5.z, l(1)
  mov r2.y, r2.z
endloop 
mov o0.xyz, r2.yyyy
mov o0.w, l(1.000000)
ret 
// Approximately 0 instruction slots used